{% extends "base.html" %}

{% block content %}
<div class="dashboard-header">
    <div>
        <h1>Portfolio Dashboard</h1>
        <p style="color: var(--text-secondary);">Manage and monitor climate risk across all assets.</p>
    </div>
    <button class="btn btn-cta" onclick="document.getElementById('upload-input').click()">
        <i class="fa-solid fa-upload"></i> Upload CSV
    </button>
    <input type="file" id="upload-input" style="display: none;" accept=".csv">
</div>

<div class="dashboard-grid">
    <!-- Map View -->
    <div class="glass-card" style="height: 500px; padding: 0; overflow: hidden;">
        <div id="portfolio-map" style="width: 100%; height: 100%;"></div>
    </div>

    <!-- Risk Distribution -->
    <div class="glass-card">
        <h3>Risk Distribution</h3>
        <canvas id="riskPieChart" style="margin-top: 2rem;"></canvas>
        <div style="margin-top: 2rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>High Risk (>40)</span>
                <span class="text-red">12%</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Medium Risk (50-79)</span>
                <span class="text-amber">35%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Low Risk (80+)</span>
                <span class="text-green">53%</span>
            </div>
        </div>
    </div>

    <!-- Properties List -->
    <div class="glass-card" style="grid-column: span 2;">
        <h3>Recent Assessments</h3>
        <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
            <thead>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left;">
                    <th style="padding: 1rem;">Property ID</th>
                    <th style="padding: 1rem;">Location</th>
                    <th style="padding: 1rem;">Score</th>
                    <th style="padding: 1rem;">Risk Level</th>
                    <th style="padding: 1rem;">Action</th>
                </tr>
            </thead>
            <tbody id="portfolio-table-body">
                <!-- Populated by JS -->
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script>
    loadPortfolioData();
</script>
{% endblock %}